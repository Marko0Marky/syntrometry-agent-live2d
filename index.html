<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heim's Syntrometric Theory & Live2D Agent Demo</title>
    
    <!-- SEO & Meta -->
    <meta name="description" content="Interactive visualization of Heim's Syntrometric Theory with AI-driven Live2D agent, featuring real-time simulations and concept exploration.">
    <meta name="keywords" content="syntrometric theory, live2d, AI agent, interactive visualization, complex systems">
    <meta name="author" content="Heim Theory Research">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="Heim's Syntrometric Theory Demo">
    <meta property="og:description" content="Interactive visualization of complex systems through higher-dimensional interactions">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="32x32">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cubism.live2d.com" crossorigin>
    
    <!-- Google Fonts with font-display: swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Critical CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Enhanced Script Error Handling -->
    <script>
        // Enhanced error handling with better UX
        class ScriptErrorHandler {
            constructor() {
                this.errors = new Map();
                this.retryAttempts = new Map();
                this.maxRetries = 2;
                this.containerCreated = false; // Don't create container immediately, wait for DOM
            }
            
            createErrorContainer() {
                if (this.containerCreated || document.getElementById('error-message')) {
                    this.containerCreated = true;
                    return;
                }
                if (!document.body) return; // Check if body exists
                
                const errorEl = document.createElement('div');
                errorEl.id = 'error-message';
                errorEl.className = 'error-message global-error-message'; // Added class for specific global styling
                errorEl.setAttribute('role', 'alert');
                errorEl.setAttribute('aria-live', 'assertive');
                errorEl.style.display = 'none';
                
                const header = document.querySelector('header');
                if (header && header.nextSibling) {
                    header.parentNode.insertBefore(errorEl, header.nextSibling);
                } else {
                    document.body.prepend(errorEl);
                }
                this.containerCreated = true;
            }
            
            handleError(library, fallbackUrl = null, customMessage = '') {
                console.error(`[ScriptLoader] Failed to load ${library}. ${customMessage}`);
                const errorKey = library.toLowerCase().replace(/\s+/g, '-');
                const currentRetries = this.retryAttempts.get(errorKey) || 0;
                
                if (currentRetries < this.maxRetries && fallbackUrl) {
                    this.retryAttempts.set(errorKey, currentRetries + 1);
                    console.log(`[ScriptLoader] Retry attempt ${currentRetries + 1}/${this.maxRetries} for ${library}`);
                    this.loadFallback(fallbackUrl, library, errorKey);
                } else {
                    this.displayError(library, customMessage);
                }
            }
            
            loadFallback(url, library, errorKey) {
                const script = document.createElement('script');
                script.src = url;
                script.async = true;
                script.onerror = () => {
                    console.error(`[ScriptLoader] Fallback failed for ${library}: ${url}`);
                    this.displayError(library, 'Fallback also failed to load.');
                };
                script.onload = () => {
                    console.log(`[ScriptLoader] Successfully loaded fallback for ${library}`);
                    this.errors.delete(errorKey);
                    this.updateErrorDisplay();
                };
                document.head.appendChild(script);
            }
            
            displayError(library, message) {
                const errorKey = library.toLowerCase().replace(/\s+/g, '-');
                this.errors.set(errorKey, { library, message });
                this.updateErrorDisplay();
            }
            
            updateErrorDisplay() {
                // Ensure container is created on first error if not already by DOM
                if (!this.containerCreated) this.createErrorContainer();
                const errorEl = document.getElementById('error-message');
                if (!errorEl) return;
                
                if (this.errors.size === 0) {
                    errorEl.style.display = 'none';
                    return;
                }
                
                const errorMessages = Array.from(this.errors.values())
                    .map(({ library, message }) => `<strong>${library}:</strong> ${message}`)
                    .join('<br>');
                
                errorEl.innerHTML = `
                    <div class="error-header">⚠️ Loading Issues Detected</div>
                    <div class="error-content">${errorMessages}</div>
                    <div class="error-actions">
                        <button onclick="window.location.reload()" class="error-retry-btn">Retry Page</button>
                        <button onclick="this.parentElement.parentElement.style.display='none'" class="error-dismiss-btn">Dismiss</button>
                    </div>
                `;
                errorEl.style.display = 'block';
            }
        }
        
        window.scriptErrorHandler = new ScriptErrorHandler();
        window.handleScriptError = (library, fallback, message) => {
            window.scriptErrorHandler.handleError(library, fallback, message);
        };
        
        // Enhanced console warning suppression
        const originalConsoleWarn = console.warn;
        const suppressedWarnings = ['gl.getProgramInfoLog', 'X3557', 'WebGL', 'WEBGL_debug_renderer_info'];
        
        console.warn = function(...args) {
            const message = args.join(' ');
            if (suppressedWarnings.some(warning => message.includes(warning))) return;
            originalConsoleWarn.apply(console, args);
        };
        
        // Performance monitoring
        window.performanceMonitor = {
            startTime: performance.now(),
            checkpoints: new Map(),
            checkpoint(name) {
                this.checkpoints.set(name, performance.now() - this.startTime);
                console.log(`[Performance] ${name}: ${this.checkpoints.get(name).toFixed(2)}ms`);
            }
        };
    </script>
</head>

<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <header role="banner">
        <div class="header-content">
            <h1>Heim's Syntrometric Theory & Live2D Agent Demo</h1>
            <p class="header-subtitle">Interactive visualization of Syntrometric concepts with an AI-driven Live2D agent <span class="version-badge">V2.3</span></p>
            
            <nav class="header-nav" aria-label="Primary navigation">
                <ul>
                    <li><a href="#syntrometry-viz-heading">Simulation</a></li>
                    <li><a href="#concept-viz-heading">Concepts</a></li>
                    <li><a href="#theory-heading">Theory</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Global Error Message Container (managed by ScriptErrorHandler) -->
    <div id="error-message" class="error-message global-error-message" role="alert" aria-live="assertive" style="display: none;"></div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" role="status" aria-label="Loading application">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Initializing Syntrometric Simulation</h2>
            <p id="loading-status">Loading core systems...</p>
            <div class="loading-progress">
                <div class="progress-bar" id="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <main id="main-content" role="main">
        <!-- Syntrometric Theory Section -->
        <section class="theory-section" aria-labelledby="theory-heading">
            <div class="section-container">
                <h2 id="theory-heading">Syntrometric Theory Overview</h2>
                <div class="theory-content">
                    <p class="theory-intro">
                        Heim's Syntrometric Theory proposes a framework for understanding complex systems through higher-dimensional interactions of <strong>Syntrix</strong> and <strong>Metrons</strong>, governed by <em>Reflexive Integration</em> and <em>Structural Condensation</em>.
                    </p>
                    
                    <details class="theory-details">
                        <summary>Learn More About Core Concepts</summary>
                        <div class="theory-expanded">
                            <dl class="concept-definitions">
                                <dt>Syntrix</dt>
                                <dd>Fundamental structural elements that define system organization</dd>
                                <dt>Metrons</dt>
                                <dd>Measurement units that quantify system states and transformations</dd>
                                <dt>Reflexive Integration</dt>
                                <dd>Self-referential processes that enable system self-awareness</dd>
                                <dt>Structural Condensation</dt>
                                <dd>Mechanisms by which complex patterns emerge from simpler interactions</dd>
                            </dl>
                        </div>
                    </details>
                </div>
                
                <nav class="quick-links" aria-label="Related resources">
                    <h3>Explore Further</h3>
                    <div class="quick-links-grid">
                        <a href="syntrometrie_framework.html" class="quick-link-card" title="View 2D Framework Diagram">
                            <span class="link-icon">📊</span> <span class="link-title">Framework Diagram</span> <span class="link-desc">2D visualization of core relationships</span>
                        </a>
                        <a href="conscious_agent_arch.html" class="quick-link-card" title="View Agent Architecture">
                            <span class="link-icon">🤖</span> <span class="link-title">Agent Architecture</span> <span class="link-desc">Conscious agent system design</span>
                        </a>
                        <a href="README.md" class="quick-link-card" title="Project Documentation">
                            <span class="link-icon">📚</span> <span class="link-title">Documentation</span> <span class="link-desc">Complete project guide</span>
                        </a>
                        <a href="https://heim-theory.com/" target="_blank" rel="noopener noreferrer" class="quick-link-card external-link" title="External Resource">
                            <span class="link-icon">🌐</span> <span class="link-title">Heim Theory</span> <span class="link-desc">Official theory resources</span>
                        </a>
                    </div>
                </nav>
            </div>
        </section>

        <!-- Visualization Sections Wrapper -->
        <div class="visualization-wrapper">
            <!-- Interactive Simulation Section -->
            <section class="visualization-section" aria-labelledby="syntrometry-viz-heading">
                <div class="section-container">
                    <header class="section-header">
                        <h2 id="syntrometry-viz-heading">Syntrometric Simulation</h2>
                        <p class="section-description">
                            Explore the interactive simulation with real-time agent responses and adaptive learning mechanisms.
                        </p>
                        <div class="status-indicator" id="simulation-status" role="status">
                            <span class="status-dot" aria-hidden="true"></span>
                            <span class="status-text">Ready</span>
                        </div>
                    </header>
                    
                    <div class="visualization-container threejs-container" id="syntrometry-panel" 
                         aria-label="Syntrometric Simulation Interface" role="application">
                        
                        <div id="syntrometry-error-message" class="error-message local-error" role="alert" style="display: none;"></div>
                        
                        <!-- Add syntrometry controls with fullscreen button on the left side -->
                        <div class="syntrometry-controls syntrometry-controls-left">
                            <div class="view-controls">
                                <button id="syntrometry-fullscreen" class="btn btn-secondary">
                                    <span class="btn-icon">⛶</span> Fullscreen
                                </button>
                                <button id="reset-syntrometry-view" class="btn btn-secondary">
                                    <span class="btn-icon">🎯</span> Reset View
                                </button>
                            </div>
                        </div>
                        
                        <div id="live2d-container" class="avatar-container" aria-label="AI Agent Avatar">
                            <div class="avatar-loading" id="avatar-loading">
                                <div class="avatar-placeholder">
                                    <div class="placeholder-icon">🤖</div>
                                    <div class="placeholder-text" id="avatar-loading-text">Loading Agent...</div>
                                </div>
                            </div>
                            <!-- Add a script to force update the loading text after a timeout -->
                            <script>
                                // Force update the avatar loading text after 5 seconds
                                setTimeout(() => {
                                    const loadingText = document.getElementById('avatar-loading-text');
                                    if (loadingText) {
                                        loadingText.textContent = 'Agent Ready';
                                    }
                                    
                                    // Also try to hide the loading overlay
                                    const avatarLoading = document.getElementById('avatar-loading');
                                    if (avatarLoading) {
                                        avatarLoading.style.opacity = '0';
                                        setTimeout(() => {
                                            avatarLoading.style.display = 'none';
                                        }, 500);
                                    }
                                }, 5000);
                            </script>
                        </div>

                        <div id="controls" class="overlay-panel controls-container panel-draggable" 
                             aria-label="Simulation Controls" role="region">
                            <header class="panel-header" role="button" tabindex="0" aria-expanded="true" aria-controls="controls-content">
                                <span class="panel-title">Controls</span>
                                <button class="panel-toggle" aria-label="Toggle Controls Panel">▼</button>
                            </header>
                            <div class="panel-content" id="controls-content">
                                <div class="info-content">
                                    <p class="info-intro">
                                        Hover over, click, or use keyboard navigation to explore concept nodes and their relationships.
                                    </p>
                                    <div class="concept-legend">
                                        <h4>Node Types</h4>
                                        <ul class="legend-list">
                                            <li><span class="legend-color core"></span> Core Concepts</li>
                                            <li><span class="legend-color process"></span> Processes</li>
                                            <li><span class="legend-color property"></span> Properties</li>
                                            <li><span class="legend-color relation"></span> Relations</li>
                                        </ul>
                                    </div>
                                    <div class="interaction-help">
                                        <h4>Controls</h4>
                                        <dl class="help-list">
                                            <dt>Mouse/Touch:</dt> <dd>Drag to rotate, scroll to zoom, click nodes for details</dd>
                                            <dt>Keyboard:</dt> <dd>Arrow keys to navigate, Enter to select, Esc to deselect</dd>
                                        </dl>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label for="integration-slider" class="control-label">
                                        Integration (I(S)) <span class="control-badge">Agent Learned</span>
                                    </label>
                                    <div class="slider-container">
                                        <input class="read-only-slider" type="range" id="integration-slider" 
                                               name="integration" min="0" max="1" step="0.01" value="0.5" 
                                               aria-describedby="integration-desc" disabled>
                                        <output for="integration-slider" id="integration-value" class="slider-value">0.50</output>
                                    </div>
                                    <small id="integration-desc" class="control-desc">
                                        Reflects agent's internal integration value. Updates automatically.
                                    </small>
                                </div>
                                <div class="control-group">
                                    <label for="reflexivity-slider" class="control-label">
                                        Reflexivity (Ψ) <span class="control-badge">Agent Learned</span>
                                    </label>
                                    <div class="slider-container">
                                        <input class="read-only-slider" type="range" id="reflexivity-slider" 
                                               name="reflexivity" min="0" max="1" step="0.01" value="0.5" 
                                               aria-describedby="reflexivity-desc" disabled>
                                        <output for="reflexivity-slider" id="reflexivity-value" class="slider-value">0.50</output>
                                    </div>
                                    <small id="reflexivity-desc" class="control-desc">
                                        Reflects agent's internal reflexivity value. Updates automatically.
                                    </small>
                                </div>
                                <div class="button-group" role="group" aria-label="Simulation actions">
                                    <button id="save-state-button" type="button" class="btn btn-secondary" disabled>
                                        <span class="btn-icon">💾</span> Save State
                                    </button>
                                    <button id="load-state-button" type="button" class="btn btn-secondary" disabled>
                                        <span class="btn-icon">📁</span> Load State
                                    </button>
                                    <button id="pause-button" type="button" class="btn btn-primary">
                                        <span class="btn-icon">⏸️</span> Pause
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="concept-navigation" class="concept-nav-overlay" role="navigation" aria-label="Concept navigation">
                            <div class="nav-cluster" data-cluster="core">
                                <button class="nav-button" data-concept="syntrix">Syntrix</button>
                                <button class="nav-button" data-concept="metron">Metron</button>
                            </div>
                            <div class="nav-cluster" data-cluster="processes">
                                <button class="nav-button" data-concept="integration">Integration</button>
                                <button class="nav-button" data-concept="condensation">Condensation</button>
                            </div>
                        </div>

                        <div id="chat-container" class="overlay-panel chat-container panel-draggable" 
                             aria-label="Agent Communication" role="region">
                            <header class="panel-header" role="button" tabindex="0" aria-expanded="true" aria-controls="chat-content">
                                <span class="panel-title">Agent Chat</span>
                                <div class="chat-status">
                                    <span class="status-indicator online" id="chat-status-indicator"></span>
                                    <span class="status-text" id="chat-status-text">Connecting...</span>
                                </div>
                                <!-- <button class="panel-toggle" aria-label="Toggle Chat Panel">▼</button> -->
                            </header>
                            <div class="panel-content" id="chat-content">
                                <div id="chat-output" class="chat-messages" role="log" aria-live="polite" aria-label="Chat history">
                                    <div class="chat-message system-message">
                                        <span class="message-sender">System</span>
                                        <span class="message-content">Welcome to the Syntrometric Simulation (V2.3). Initializing agent...</span>
                                        <time class="message-time" datetime="">Just now</time>
                                    </div>
                                </div>
                                <div class="chat-input-container">
                                    <label for="chat-input" class="sr-only">Message to agent</label>
                                    <input id="chat-input" type="text" class="chat-input" 
                                           placeholder="Loading agent, please wait..." 
                                           aria-label="Chat message input" 
                                           maxlength="500" disabled>
                                    <button id="chat-send-button" type="button" class="chat-send-btn" 
                                            aria-label="Send message" disabled>
                                        <span class="btn-icon">📤</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="dashboard-panel" class="overlay-panel dashboard-container panel-draggable" 
                             aria-label="Agent Metrics Dashboard" role="region">
                            <header class="panel-header" role="button" tabindex="0" aria-expanded="true" aria-controls="dashboard-content">
                                <span class="panel-title">Agent Dashboard</span>
                                <button class="panel-refresh" aria-label="Refresh metrics">🔄</button>
                                <!-- <button class="panel-toggle" aria-label="Toggle Dashboard Panel">▼</button> -->
                            </header>
                            <div class="panel-content" id="dashboard-content">
                                <div class="dashboard-metrics" role="group" aria-label="Core metrics">
                                    <div class="metric-item">
                                        <label id="metric-rih-label" class="metric-label">RIH (Reflexive Integration Harmony)</label>
                                        <div class="metric-display">
                                            <progress id="metric-rih-progress" value="0" max="100" 
                                                     aria-labelledby="metric-rih-label" aria-describedby="metric-rih-desc"></progress>
                                            <output id="metric-rih-value" class="metric-value" for="metric-rih-progress">0.0%</output>
                                        </div>
                                        <small id="metric-rih-desc" class="metric-desc sr-only">Measures system coherence and stability</small>
                                    </div>
                                    <div class="metric-item">
                                        <label id="metric-affinity-label" class="metric-label">Affinity</label>
                                        <div class="metric-display">
                                            <progress id="metric-affinity-progress" value="50" max="100"
                                                     aria-labelledby="metric-affinity-label" aria-describedby="metric-affinity-desc"></progress>
                                            <output id="metric-affinity-value" class="metric-value" for="metric-affinity-progress">0.00</output>
                                        </div>
                                        <small id="metric-affinity-desc" class="metric-desc sr-only">Agent's connection to simulation context</small>
                                    </div>
                                    <div class="metric-item">
                                        <label id="metric-trust-label" class="metric-label">Trust Level</label>
                                        <div class="metric-display">
                                            <progress id="metric-trust-progress" value="100" max="100"
                                                     aria-labelledby="metric-trust-label" aria-describedby="metric-trust-desc"></progress>
                                            <output id="metric-trust-value" class="metric-value" for="metric-trust-progress">100.0%</output>
                                        </div>
                                        <small id="metric-trust-desc" class="metric-desc sr-only">System reliability and consistency</small>
                                    </div>
                                    <div class="metric-row">
                                        <div class="metric-item metric-compact">
                                            <label id="metric-belief-norm-label" class="metric-label">Belief Norm</label>
                                            <output id="metric-belief-norm" class="metric-value" aria-labelledby="metric-belief-norm-label">0.000</output>
                                        </div>
                                        <div class="metric-item metric-compact">
                                            <label id="metric-self-norm-label" class="metric-label">Self Norm</label>
                                            <output id="metric-self-norm" class="metric-value" aria-labelledby="metric-self-norm-label">0.000</output>
                                        </div>
                                    </div>
                                    <div class="metric-item metric-context">
                                        <label id="metric-context-label" class="metric-label">Current Context</label>
                                        <output id="metric-context" class="metric-value context-value" aria-labelledby="metric-context-label">Initializing...</output>
                                    </div>
                                </div>
                                <div id="emotion-intensities" class="emotion-section" role="group" aria-label="Emotional state">
                                    <h4 class="section-subtitle">Emotional Spectrum</h4>
                                    <div class="emotion-grid">
                                        <!-- Example Emotion Item (repeat for others) -->
                                        <div class="emotion-item" data-emotion="Joy">
                                            <label class="emotion-label" id="emotion-label-joy">Joy</label>
                                            <div class="emotion-bar" role="meter" aria-labelledby="emotion-label-joy" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                                <div class="emotion-fill" style="width: 0%;"></div>
                                            </div>
                                            <output class="emotion-value" for="emotion-label-joy">0%</output>
                                        </div>
                                        <div class="emotion-item" data-emotion="Fear">
                                            <label class="emotion-label" id="emotion-label-fear">Fear</label>
                                            <div class="emotion-bar" role="meter" aria-labelledby="emotion-label-fear" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                                <div class="emotion-fill" style="width: 0%;"></div>
                                            </div>
                                            <output class="emotion-value" for="emotion-label-fear">0%</output>
                                        </div>
                                        <div class="emotion-item" data-emotion="Curiosity">
                                            <label class="emotion-label" id="emotion-label-curiosity">Curiosity</label>
                                            <div class="emotion-bar" role="meter" aria-labelledby="emotion-label-curiosity" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                                <div class="emotion-fill" style="width: 0%;"></div>
                                            </div>
                                            <output class="emotion-value" for="emotion-label-curiosity">0%</output>
                                        </div>
                                        <div class="emotion-item" data-emotion="Frustration">
                                            <label class="emotion-label" id="emotion-label-frustration">Frustration</label>
                                            <div class="emotion-bar" role="meter" aria-labelledby="emotion-label-frustration" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                                <div class="emotion-fill" style="width: 0%;"></div>
                                            </div>
                                            <output class="emotion-value" for="emotion-label-frustration">0%</output>
                                        </div>
                                        <div class="emotion-item" data-emotion="Calm">
                                            <label class="emotion-label" id="emotion-label-calm">Calm</label>
                                            <div class="emotion-bar" role="meter" aria-labelledby="emotion-label-calm" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                                <div class="emotion-fill" style="width: 0%;"></div>
                                            </div>
                                            <output class="emotion-value" for="emotion-label-calm">0%</output>
                                        </div>
                                        <div class="emotion-item" data-emotion="Surprise">
                                            <label class="emotion-label" id="emotion-label-surprise">Surprise</label>
                                            <div class="emotion-bar" role="meter" aria-labelledby="emotion-label-surprise" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                                                <div class="emotion-fill" style="width: 0%;"></div>
                                            </div>
                                            <output class="emotion-value" for="emotion-label-surprise">0%</output>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-section">
                                    <h4 class="section-subtitle">Metrics Timeline</h4>
                                    <div class="chart-container">
                                        <canvas id="metrics-chart" aria-label="Real-time metrics chart"></canvas>
                                    </div>
                                </div>
                                <div id="expression-timeline" class="timeline-section">
                                    <h4 class="section-subtitle">Recent Actions</h4>
                                    <ul id="expressions-list" class="expressions-list" role="log" aria-label="Agent actions timeline"></ul>
                                </div>
                            </div>
                        </div>

                        <div id="heatmap-panel" class="overlay-panel heatmap-container panel-draggable" 
                             aria-label="Agent Internal State Visualization" role="region">
                            <header class="panel-header" role="button" tabindex="0" aria-expanded="true" aria-controls="heatmap-content-wrapper">
                                <span class="panel-title">Self-State Activation</span>
                                <div class="panel-controls">
                                    <button class="panel-control" aria-label="Refresh heatmap">🔄</button>
                                    <button class="panel-control" aria-label="Export heatmap">📊</button>
                                </div>
                                <!-- <button class="panel-toggle" aria-label="Toggle Heatmap Panel">▼</button> -->
                            </header>
                            <div class="panel-content" id="heatmap-content-wrapper">
                                <div id="heatmap-content" class="heatmap-content" role="img" 
                                     aria-label="Agent internal state heatmap visualization">
                                    <div class="loading-placeholder">
                                        <div class="loading-spinner"></div>
                                        <span>Initializing heatmap data...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tensor-inspector-panel" class="overlay-panel tensor-inspector-container panel-draggable" 
                             aria-label="Belief Embedding Inspector" role="region">
                            <header class="panel-header" role="button" tabindex="0" aria-expanded="true" aria-controls="tensor-inspector-content-wrapper">
                                <span class="panel-title">Belief Embedding Inspector</span>
                                <button id="toggle-inspector" class="panel-control" 
                                        title="Toggle Inspector View" aria-label="Toggle detailed view">👁️</button>
                                <!-- <button class="panel-toggle" aria-label="Toggle Tensor Inspector Panel">▼</button> -->
                            </header>
                            <div class="panel-content" id="tensor-inspector-content-wrapper">
                                <pre id="tensor-inspector-content" class="tensor-content" role="log" 
                                     aria-label="Belief embedding tensor data">
                                    <!-- Content will be populated by JavaScript -->
                                    <div class="tensor-data">
                                        [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000]
                                    </div>
                                </pre>
                            </div>
                        </div>

                        <div id="cascade-viewer-panel" class="overlay-panel cascade-viewer-container panel-draggable" 
                             aria-label="Strukturkaskade Viewer" role="region">
                            <header class="panel-header" role="button" tabindex="0" aria-expanded="true" aria-controls="cascade-viewer-content-wrapper">
                                <span class="panel-title">Strukturkaskade Viewer</span>
                                <div class="panel-controls">
                                    <button class="panel-control" aria-label="Zoom in">🔍+</button>
                                    <button class="panel-control" aria-label="Zoom out">🔍-</button>
                                </div>
                                <!-- <button class="panel-toggle" aria-label="Toggle Cascade Viewer Panel">▼</button> -->
                            </header>
                            <div class="panel-content" id="cascade-viewer-content-wrapper">
                                <div id="cascade-viewer-content" class="cascade-content" 
                                     aria-label="Strukturkaskade visualization data">
                                    <div class="loading-placeholder">
                                        <div class="loading-spinner"></div>
                                        <span>Initializing Strukturkaskade data...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Concept Graph Section -->
            <section class="visualization-section" aria-labelledby="concept-viz-heading">
                <div class="section-container">
                    <header class="section-header">
                        <h2 id="concept-viz-heading">Concept Graph Visualization</h2>
                        <p class="section-description">
                            Explore the relationships between Syntrometric concepts through an interactive knowledge graph.
                        </p>
                    </header>
                    
                    <div class="concept-controls">
                        <div class="control-group">
                            <label class="toggle-label" for="labels-toggle">
                                <input type="checkbox" id="labels-toggle" aria-describedby="labels-toggle-desc">
                                <span class="toggle-slider"></span>
                                Show All Concept Labels
                            </label>
                            <small id="labels-toggle-desc" class="control-desc sr-only">
                                Toggle visibility of all node labels in the concept graph.
                            </small>
                        </div>
                        <div class="view-controls">
                            <button id="reset-view" class="btn btn-secondary">
                                <span class="btn-icon">🎯</span> Reset View
                            </button>
                            <button id="fullscreen-concept" class="btn btn-secondary">
                                <span class="btn-icon">⛶</span> Fullscreen
                            </button>
                        </div>
                    </div>
                    
                    <div class="visualization-container threejs-container-concept" id="concept-panel" 
                         aria-label="Interactive Concept Graph" role="application" tabindex="0">
                        <div id="concept-error-message" class="error-message local-error" role="alert" style="display: none;"></div>
                        
                        <button id="toggle-info-panel" class="info-toggle-button floating-btn" 
                                aria-label="Toggle concept information panel" aria-expanded="false" aria-controls="info-panel-content">
                            <span class="btn-icon">ℹ️</span>
                            <span class="btn-text">Info</span>
                        </button>
                        
                        <div id="info-panel" class="overlay-panel info-panel-container" 
                             aria-label="Concept Information Panel" role="complementary" aria-hidden="true">
                            <header class="panel-header">
                                <h3 class="panel-title">Concept Information</h3>
                                <button class="panel-close" aria-label="Close panel">✕</button>
                            </header>
                            <div class="panel-content" id="info-panel-content">
                                <!-- Content for info panel will be populated by JavaScript -->
                                <p>Select a concept node in the graph to see its details here.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer role="contentinfo" class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Heim's Syntrometric Theory</h3>
                <p>Advanced framework for understanding complex systems through higher-dimensional interactions.</p>
            </div>
            <div class="footer-section">
                <h4>Resources</h4>
                <ul>
                    <li><a href="README.md">Documentation</a></li>
                    <li><a href="https://heim-theory.com/" target="_blank" rel="noopener noreferrer">Official Site</a></li>
                    <li><a href="#theory-heading">Theory Overview</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Technical</h4>
                <ul>
                    <li><a href="#" id="performance-stats">Performance Stats</a></li>
                    <li><a href="#" id="system-info">System Info</a></li>
                    <li><a href="#" id="accessibility-info">Accessibility</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2024 Heim Theory Research. <span class="build-info">Build: <span id="build-version">2.3.0</span></span></p>
        </div>
    </footer>

    <!-- Accessibility Announcements -->
    <div id="announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>

    <!-- Performance and Dependencies Management Scripts -->
    <script>
        // Enhanced dependency loading with better error recovery
        class DependencyManager {
            constructor() {
                this.dependencies = new Map();
                this.loadingPromises = new Map();
                this.criticalDependencies = ['tensorflowjs', 'threejs', 'pixijs', 'chartjs'];
            }
            async loadDependency(name, urls, critical = false) {
                if (this.dependencies.has(name)) return this.dependencies.get(name);
                if (this.loadingPromises.has(name)) return this.loadingPromises.get(name);
                const loadPromise = this.attemptLoad(name, urls, critical);
                this.loadingPromises.set(name, loadPromise);
                try {
                    const result = await loadPromise;
                    this.dependencies.set(name, result);
                    return result;
                } catch (error) {
                    this.loadingPromises.delete(name);
                    throw error;
                }
            }
            async attemptLoad(name, urls, critical) {
                const urlArray = Array.isArray(urls) ? urls : [urls];
                let lastError;
                for (const url of urlArray) {
                    try {
                        await this.loadScript(url);
                        console.log(`[DependencyManager] Successfully loaded ${name} from ${url}`);
                        return { name, url, loaded: true };
                    } catch (error) {
                        console.warn(`[DependencyManager] Failed to load ${name} from ${url}:`, error);
                        lastError = error;
                    }
                }
                if (critical) throw new Error(`Critical dependency ${name} failed to load: ${lastError?.message}`);
                console.error(`[DependencyManager] All attempts failed for ${name}`);
                return { name, loaded: false, error: lastError };
            }
            loadScript(url) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = url;
                    script.async = true;
                    script.onload = resolve;
                    script.onerror = () => reject(new Error(`Failed to load script: ${url}`));
                    document.head.appendChild(script);
                });
            }
        }
        window.dependencyManager = new DependencyManager();
        
        class LoadingManager {
            constructor() {
                this.totalSteps = 14;
                this.currentStep = 0;
                this.loadingScreen = document.getElementById('loading-screen');
                this.progressBar = document.getElementById('loading-progress-bar');
                this.statusText = document.getElementById('loading-status');
                this.startTime = performance.now();
                
                // Set a maximum loading time of 20 seconds
                this.maxLoadingTime = setTimeout(() => {
                    console.warn('[LoadingManager] Maximum loading time reached, forcing completion');
                    this.forceComplete();
                }, 20000);
            }
            
            updateProgress(step, message) {
                this.currentStep = Math.min(step, this.totalSteps);
                const percentage = (this.currentStep / this.totalSteps) * 100;
                if (this.progressBar) this.progressBar.style.width = `${percentage}%`;
                if (this.statusText && message) this.statusText.textContent = message;
                console.log(`[LoadingManager] Progress: ${this.currentStep}/${this.totalSteps} (${Math.round(percentage)}%) - ${message}`);
            }
            
            // Force complete without transitions or delays
            forceComplete() {
                console.log("[LoadingManager] Force completing loading process");
                clearTimeout(this.maxLoadingTime);
                
                if (this.loadingScreen) {
                    this.loadingScreen.style.display = 'none';
                    console.log("[LoadingManager] Loading screen forcibly hidden");
                }
                
                const loadTime = performance.now() - this.startTime;
                console.log(`[LoadingManager] Application force-loaded in ${loadTime.toFixed(2)}ms`);
                window.performanceMonitor?.checkpoint('Application Ready (Forced)');
            }
            
            complete() {
                console.log("[LoadingManager] Complete called - finalizing loading process");
                this.updateProgress(this.totalSteps, 'Initialization complete');
                clearTimeout(this.maxLoadingTime);
                
                const loadTime = performance.now() - this.startTime;
                
                // IMPORTANT: Delay slightly to ensure UI is ready and transitions can play
                setTimeout(() => {
                    if (this.loadingScreen) {
                        console.log("[LoadingManager] Starting opacity transition");
                        this.loadingScreen.style.opacity = '0';
                        
                        // Add a safety timeout in case transitionend doesn't fire
                        const safetyTimeout = setTimeout(() => {
                            console.log("[LoadingManager] Safety timeout triggered - forcing hide");
                            if (this.loadingScreen && this.loadingScreen.style.display !== 'none') {
                                this.loadingScreen.style.display = 'none';
                            }
                        }, 2000); // 2 second safety
                        
                        this.loadingScreen.addEventListener('transitionend', () => {
                            console.log("[LoadingManager] Transition completed - hiding screen");
                            clearTimeout(safetyTimeout); // Clear safety timeout
                            this.loadingScreen.style.display = 'none';
                            // Focus management after loading
                            const firstFocusable = document.querySelector('main [tabindex="0"], main button:not([disabled]), main input:not([disabled]), main a[href]');
                            if (firstFocusable) firstFocusable.focus();
                        }, { once: true }); // Crucial: use once: true
                    } else {
                        console.warn("[LoadingManager] Loading screen element not found");
                    }
                    
                    console.log(`[LoadingManager] Application loaded in ${loadTime.toFixed(2)}ms`);
                    window.performanceMonitor?.checkpoint('Application Ready');
                }, 200); // A small delay helps ensure UI is ready
            }
            
            error(message, error) {
                this.updateProgress(this.currentStep, `Error: ${message}`);
                console.error('[LoadingManager]', message, error);
                clearTimeout(this.maxLoadingTime);
                
                if (this.statusText) {
                    this.statusText.innerHTML = `
                        <span class="error-text">⚠️ ${message}</span>
                        <button onclick="window.location.reload()" class="retry-button">Retry</button>`;
                }
                
                // Hide loading screen after a short delay
                setTimeout(() => {
                    if (this.loadingScreen) {
                        this.loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            this.loadingScreen.style.display = 'none';
                            console.log("[LoadingManager] Loading screen hidden after error");
                        }, 500);
                    }
                }, 2000);
            }
        }
        window.loadingManager = new LoadingManager();
        
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                const openModals = document.querySelectorAll('.overlay-panel[aria-expanded="true"]:not([aria-hidden="true"])');
                if (openModals.length > 0) {
                    const panelToClose = openModals[openModals.length - 1];
                    const closeButton = panelToClose.querySelector('.panel-close, .panel-toggle');
                    if (closeButton) {
                        closeButton.click();
                         event.preventDefault();
                    } else if (panelToClose.id === 'info-panel') { // Special handling for info panel
                        document.getElementById('toggle-info-panel')?.click();
                        event.preventDefault();
                    }
                }
            }
            // Tab trapping can be complex and might be better handled by a dedicated library if needed for specific modals.
            // The current tab trapping logic is a bit broad.
        });
    </script>

    <!-- Load Dependencies -->
    <script>
        const dependencyQueue = [
            { name: 'tensorflowjs', urls: ['https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js', 'https://unpkg.com/@tensorflow/tfjs@4.21.0/dist/tf.min.js'], critical: true },
            { name: 'threejs', urls: ['https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js', 'https://unpkg.com/three@0.132.2/build/three.min.js'], critical: true },
            { name: 'threejs-controls', urls: ['https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js', 'https://unpkg.com/three@0.132.2/examples/js/controls/OrbitControls.js'] },
            { name: 'threejs-renderers', urls: ['https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/renderers/CSS2DRenderer.js', 'https://unpkg.com/three@0.132.2/examples/js/renderers/CSS2DRenderer.js'] },
            { name: 'pixijs', urls: ['https://cdn.jsdelivr.net/npm/pixi.js@6.5.10/dist/browser/pixi.min.js', 'https://unpkg.com/pixi.js@6.5.10/dist/browser/pixi.min.js'], critical: true },
            { name: 'cubism-core', urls: ['https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js', 'https://unpkg.com/live2dcubismcore@1.0.0/live2dcubismcore.min.js'] },
            { name: 'pixi-live2d', urls: ['https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/cubism4.min.js', 'https://unpkg.com/pixi-live2d-display@0.4.0/dist/cubism4.min.js'] },
            { name: 'luxon', urls: ['https://cdn.jsdelivr.net/npm/luxon@2.5.2/build/global/luxon.min.js', 'https://unpkg.com/luxon@2.5.2/build/global/luxon.min.js'] },
            { name: 'chartjs', urls: ['https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js', 'https://unpkg.com/chart.js@3.9.1/dist/chart.min.js'], critical: true },
            { name: 'chartjs-adapter', urls: ['https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0/dist/chartjs-adapter-luxon.min.js', 'https://unpkg.com/chartjs-adapter-luxon@1.2.0/dist/chartjs-adapter-luxon.min.js'] },
            { name: 'chartjs-streaming', urls: ['https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0/dist/chartjs-plugin-streaming.min.js', 'https://unpkg.com/chartjs-plugin-streaming@2.0.0/dist/chartjs-plugin-streaming.min.js'] }
        ];
        
        async function loadAllDependencies() {
            for (let i = 0; i < dependencyQueue.length; i++) {
                const dep = dependencyQueue[i];
                window.loadingManager?.updateProgress(i + 1, `Loading ${dep.name}...`);
                try {
                    await window.dependencyManager.loadDependency(dep.name, dep.urls, dep.critical);
                    console.log(`[Dependencies] ✓ ${dep.name} loaded successfully`);
                } catch (error) {
                    console.error(`[Dependencies] ✗ ${dep.name} failed to load:`, error);
                    if (dep.critical) {
                        window.loadingManager?.error(`Critical dependency ${dep.name} failed to load`, error);
                        return false;
                    }
                }
            }
            const criticalCheck = verifyCriticalDependencies();
            if (!criticalCheck.success) {
                window.loadingManager?.error('Critical dependencies missing', criticalCheck.error);
                return false;
            }
            return true;
        }
        
        function verifyCriticalDependencies() {
            const checks = [
                { name: 'TensorFlow.js', test: () => typeof window.tf !== 'undefined' },
                { name: 'Three.js', test: () => typeof window.THREE !== 'undefined' },
                { name: 'Pixi.js', test: () => typeof window.PIXI !== 'undefined' },
                { name: 'Chart.js', test: () => typeof window.Chart !== 'undefined' }
            ];
            for (const check of checks) {
                if (!check.test()) return { success: false, error: `${check.name} not available` };
            }
            try {
                if (window.Chart && window.ChartStreaming) { // Check Chart exists
                    window.Chart.register(window.ChartStreaming);
                    console.log('[Dependencies] Chart.js streaming plugin registered');
                }
            } catch (error) {
                console.warn('[Dependencies] Chart.js streaming plugin registration failed:', error);
            }
            return { success: true };
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            window.performanceMonitor?.checkpoint('DOM Ready');
            window.scriptErrorHandler?.createErrorContainer(); // Ensure error container is set up early
            window.loadingManager?.updateProgress(1, 'DOM loaded, initializing dependencies...');
            
            // CRITICAL FIX: Force hide loading screen after 5 seconds
            setTimeout(() => {
                console.warn('[DOMContentLoaded] Forcing loading screen hide');
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen && loadingScreen.style.display !== 'none') {
                    loadingScreen.style.display = 'none';
                }
            }, 5000);
            
            const dependenciesLoaded = await loadAllDependencies();
            
            if (dependenciesLoaded) {
                window.loadingManager?.updateProgress(dependencyQueue.length + 1, 'Loading application modules...');
                
                try {
                    const appModule = await import('./js/app.js');
                    let initApp;
                    
                    // Check for the initialize function which should be exported both as default and named
                    if (typeof appModule.default === 'function') {
                        initApp = appModule.default;
                        console.log('[App] Using default export as initialization function');
                    } else if (typeof appModule.initialize === 'function') {
                        initApp = appModule.initialize;
                        console.log('[App] Using named export "initialize" as initialization function');
                    } else {
                        console.error('[App] No initialization function found in app.js');
                        throw new Error('App initialization function not found');
                    }
                    
                    // Set a safety timeout to ensure loading screen disappears
                    window.loadingManagerTimeout = setTimeout(() => {
                        console.warn('[App] Loading timeout reached - forcing completion');
                        if (window.loadingManager && 
                            window.loadingManager.loadingScreen && 
                            window.loadingManager.loadingScreen.style.display !== 'none') {
                            window.loadingManager.forceComplete();
                        }
                    }, 10000);
                    
                    window.loadingManager?.updateProgress(dependencyQueue.length + 2, 'Initializing application...');
                    
                    // Call the initialization function
                    const initResult = await initApp();
                    console.log('[App] Initialization complete with result:', initResult);
                    
                    // Note: We don't need to call loadingManager.complete() here
                    // The app.js initialize function should handle this

                } catch (error) {
                    console.error('[App] Failed to initialize application:', error);
                    window.loadingManager?.error('Application initialization failed', error);
                    
                    // Force hide loading screen after error
                    setTimeout(() => {
                        const loadingScreen = document.getElementById('loading-screen');
                        if (loadingScreen) {
                            loadingScreen.style.opacity = '0';
                            setTimeout(() => loadingScreen.style.display = 'none', 500);
                        }
                    }, 3000);
                }
                
                // After dependencies are loaded, initialize draggable panels
                try {
                    const { initializeDraggablePanels } = await import('./js/draggablePanels.js');
                    console.log('[App] Initializing draggable panels');
                    
                    // Initialize draggable panels with proper selectors
                    initializeDraggablePanels(
                        '.panel-draggable',
                        '.visualization-container', // Constrain within this parent
                        ['input', 'button', 'textarea', 'select', 'progress', 'canvas', '.no-drag', '[role="button"]', 'a', 'pre', '.panel-content'] // Add .panel-content to prevent dragging by content
                    );
                    console.log('[App] Draggable panels initialized');
                } catch (error) {
                    console.warn('[App] Draggable panels initialization failed:', error);
                }
            }
        });
        
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                fetch('./sw.js', { method: 'HEAD' }) // Use HEAD request to check existence without downloading
                    .then(response => {
                        if (!response.ok) {
                            return Promise.reject(new Error(`Service worker file not found (${response.status})`));
                        }
                        return navigator.serviceWorker.register('./sw.js');
                    })
                    .then(registration => console.log('[ServiceWorker] Registered successfully:', registration.scope))
                    .catch(error => console.log('[ServiceWorker] Registration skipped:', error.message));
            });
        }
    </script>
    <!-- Force hide any stuck loading indicators -->
    <script>
        // Wait for the page to fully load
        window.addEventListener('load', () => {
            // Force hide avatar loading after 8 seconds
            setTimeout(() => {
                const avatarLoading = document.getElementById('avatar-loading');
                const loadingText = document.getElementById('avatar-loading-text');
                
                if (loadingText) {
                    loadingText.textContent = 'Agent Ready';
                }
                
                if (avatarLoading) {
                    avatarLoading.classList.add('hidden');
                    setTimeout(() => {
                        avatarLoading.style.display = 'none';
                    }, 500);
                }
            }, 8000);
        });
    </script>
    <!-- Force update simulation status after timeout -->
    <script>
        setTimeout(() => {
            const statusText = document.querySelector('#simulation-status .status-text');
            const statusDot = document.querySelector('#simulation-status .status-dot');
            
            if (statusText && statusText.textContent === 'Initializing...') {
                statusText.textContent = 'Ready';
            }
            
            if (statusDot) {
                statusDot.className = 'status-dot active';
            }
        }, 5000);
    </script>
    <!-- Add this script to handle fullscreen functionality -->
    <script>
        // Function to toggle fullscreen for an element
        function toggleFullscreen(elementId) {
            const element = document.getElementById(elementId);
            if (!element) {
                console.error(`[Fullscreen] Element with ID ${elementId} not found`);
                return;
            }
            
            console.log(`[Fullscreen] Toggling fullscreen for ${elementId}`);
            
            if (!document.fullscreenElement && 
                !document.mozFullScreenElement && 
                !document.webkitFullscreenElement && 
                !document.msFullscreenElement) {
                
                // Enter fullscreen
                if (element.requestFullscreen) {
                    element.requestFullscreen();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                } else if (element.mozRequestFullScreen) {
                    element.mozRequestFullScreen();
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
                }
                console.log(`[Fullscreen] Entered fullscreen for ${elementId}`);
                
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
                console.log(`[Fullscreen] Exited fullscreen`);
            }
        }

        // Initialize fullscreen buttons
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Fullscreen] Initializing fullscreen functionality');
            
            const syntrometryFullscreenBtn = document.getElementById('syntrometry-fullscreen');
            
            if (syntrometryFullscreenBtn) {
                syntrometryFullscreenBtn.addEventListener('click', function() {
                    toggleFullscreen('syntrometry-panel');
                });
                console.log('[Fullscreen] Added event listener to syntrometry fullscreen button');
            } else {
                console.warn('[Fullscreen] Syntrometry fullscreen button not found');
            }
            
            // Log all fullscreen buttons for debugging
            const allButtons = document.querySelectorAll('button');
            console.log('[Fullscreen] All buttons:', Array.from(allButtons).map(b => b.id || 'unnamed'));
        });

        // Add event listener for reset syntrometry view button
        document.addEventListener('DOMContentLoaded', async function() {
            const resetSyntrometryViewBtn = document.getElementById('reset-syntrometry-view');
            
            if (resetSyntrometryViewBtn) {
                resetSyntrometryViewBtn.addEventListener('click', async function() {
                    try {
                        const { resetSyntrometryView } = await import('./js/viz-syntrometry.js');
                        resetSyntrometryView();
                    } catch (error) {
                        console.warn('[App] Failed to reset syntrometry view:', error);
                    }
                });
                console.log('[App] Added event listener to reset syntrometry view button');
            } else {
                console.warn('[App] Reset syntrometry view button not found');
            }
        });
    </script>
</body>
</html>
