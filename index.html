<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heim's Syntrometric Theory & Live2D Agent Demo</title>
    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- External CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Inline Styles for Layout -->
    <style>
        main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        section {
            background: var(--container-background);
            border: 1px solid var(--container-border-color);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px var(--shadow-color);
        }
        .visualization-container {
            position: relative;
            height: 700px;
            border-radius: 8px;
            overflow: hidden;
        }
        .chat-container {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 350px;
            background: rgba(0, 0, 0, 0.7);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .chat-output {
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 0.5rem;
        }
        .chat-input {
            background: #333;
            border: 1px solid #555;
            color: var(--text-color);
            padding: 0.5rem;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }
        .chat-input:focus {
            border-color: var(--accent-color);
            outline: none;
        }
        .controls-container {
            position: absolute;
            top: 10px !important;
            right: 10px !important;
            left: auto !important;
            width: 250px;
            background: rgba(0, 0, 0, 0.7);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .control-group label {
            font-size: 0.9em;
            color: var(--text-muted);
        }
        .control-group input[type="range"] {
            accent-color: var(--accent-color);
        }
        .button-group {
            display: flex;
            gap: 0.5rem;
        }
        .metrics-container {
            position: absolute;
            top: 10px !important;
            left: 10px !important;
            width: 250px;
            background: rgba(0, 0, 0, 0.7);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 10;
            font-size: 0.9em;
        }
        @media (max-width: 1024px) {
            .visualization-container {
                height: 600px;
            }
            .chat-container, .controls-container, .metrics-container {
                width: calc(100% - 40px);
                left: 20px;
                right: 20px;
            }
            .metrics-container {
                top: 20px;
            }
            .controls-container {
                top: 150px;
            }
            .chat-container {
                bottom: 20px;
            }
        }
    </style>
    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js"
        onerror="handleScriptError('TensorFlow.js', null, 'Could not load TensorFlow.js.')"></script>
    <!-- Three.js -->
    <script src="https://unpkg.com/three@0.132.2/build/three.min.js"
        onerror="handleScriptError('Three.js', 'https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js', 'Could not load Three.js.')"></script>
    <!-- Three.js Examples - OrbitControls and CSS2DRenderer -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"
        onerror="handleScriptError('OrbitControls', null, 'Could load OrbitControls.')"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/renderers/CSS2DRenderer.js"
        onerror="handleScriptError('CSS2DRenderer', null, 'Could load CSS2DRenderer.')"></script>
    <!-- Pixi.js -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.3.3/dist/pixi.min.js"
        onerror="handleScriptError('Pixi.js', 'https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.3/pixi.min.js', 'Could not load Pixi.js.')"></script>
    <!-- Cubism 4 Core -->
    <script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"
        onerror="handleScriptError('Cubism 4 Core', null, 'Could not load Cubism 4 Core.')"></script>
    <!-- pixi-live2d-display -->
    <script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/cubism4.min.js"
        onerror="handleScriptError('pixi-live2d-display', 'https://unpkg.com/pixi-live2d-display@0.4.0/dist/cubism4.min.js', 'Could not load pixi-live2d-display.')"></script>
    <!-- Basic error handling for CDNs -->
    <script>
        function handleScriptError(library, fallback, message) {
            console.error(`[Error] Failed to load ${library}. ${message || ''}`);
            const errorDiv = document.getElementById('error-message');
            if (errorDiv) {
                errorDiv.innerHTML += `[Error] Failed to load ${library}. ${message || ''}<br>`;
                errorDiv.style.display = 'block';
            } else {
                console.error("Error message container not found.");
            }
            if (fallback) {
                console.log(`[Error] Attempting to load fallback: ${fallback}`);
                const script = document.createElement('script');
                script.src = fallback;
                script.onerror = () => console.error(`[Error] Fallback script ${fallback} also failed.`);
                document.head.appendChild(script);
            }
        }
        const originalConsoleWarn = console.warn;
        console.warn = function (...args) {
            if (typeof args[0] === 'string' && args[0].includes('gl.getProgramInfoLog') && args[0].includes('X3557')) {
                return;
            }
            originalConsoleWarn.apply(console, args);
        };
    </script>
</head>
<body>
    <header>
        <h1>Heim's Syntrometric Theory & Live2D Agent Demo</h1>
        <p>Interactive visualization of Syntrometric concepts with an AI-driven Live2D agent.</p>
    </header>

    <main>
        <!-- Syntrometric Theory Section -->
        <section>
            <h2>Syntrometric Theory</h2>
            <p>
                Heim's Syntrometric Theory proposes a framework for understanding complex systems through higher-dimensional interactions of Syntrix and Metrons, governed by Reflexive Integration and Structural Condensation. This demo visualizes these concepts interactively, with an AI agent reflecting emotional states via a Live2D avatar.
            </p>
            <h3>Quick Links</h3>
            <ul class="quick-links-list">
                <li><a href="research/syntrometrie_framework.html" title="View 2D Diagram">Syntrometrie Framework Diagram</a></li>
                <li><a href="research/conscious_agent_arch.html" title="View Agent Architecture">Conscious Agent Architecture Diagram</a></li>
                <li><a href="../README.md" title="Go to Main Project Readme">Main Project README</a></li>
                <li><a href="https://heim-theory.com/" target="_blank" title="External Resource (Opens New Tab)">Heim Theory Resources</a></li>
            </ul>
        </section>

        <!-- Interactive Visualization Section -->
        <section>
            <h2>Interactive Visualization</h2>
            <p>Explore the Syntrometric simulation with real-time agent responses.</p>
            <div class="visualization-container threejs-container" id="syntrometry-panel">
                <div id="error-message" class="error-message"></div>
                <div id="live2d-container"></div>
                <div id="controls" class="controls-container">
                    <div class="control-group">
                        <label for="integration-slider">Integration (I(S)): <span id="integration-value">0.50</span></label>
                        <input type="range" id="integration-slider" min="0" max="1" step="0.01" value="0.5">
                    </div>
                    <div class="control-group">
                        <label for="reflexivity-slider">Reflexivity (Î¨): <span id="reflexivity-value">0.50</span></label>
                        <input type="range" id="reflexivity-slider" min="0" max="1" step="0.01" value="0.5">
                    </div>
                    <div class="button-group">
                        <button id="save-state-button">Save State</button>
                        <button id="load-state-button">Load State</button>
                    </div>
                </div>
                <div id="chat-container" class="chat-container">
                    <div id="chat-output" class="chat-output"><div><b>System:</b> Welcome to the Syntrometric Simulation.</div></div>
                    <input id="chat-input" type="text" class="chat-input" placeholder="Interact with the simulation...">
                </div>
                <div id="metrics" class="metrics-container">Loading metrics...</div>
            </div>
        </section>

        <!-- Concept Graph Visualization Section -->
        <section>
            <h2>Concept Graph Visualization</h2>
            <p>Explore the relationships between Syntrometric concepts with interactive tooltips.</p>
            <div class="visualization-container threejs-container-concept" id="concept-panel">
                <div id="concept-error-message" class="error-message"></div>
                <div id="info-panel"></div>
            </div>
        </section>
    </main>

    <canvas id="live2d-offscreen-canvas"></canvas>

    <!-- Main application script -->
    <script type="module" src="./js/app.js"></script>
</body>
</html>
